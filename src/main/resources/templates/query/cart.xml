<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalsul.user.cart.dao.CartDAO" >

<!-- 장바구니 조회 -->
<select id="cartList" parameterType="userVO" resultType="cart">
   SELECT cl.quantity, cl.product_no, cl.product_price, p.product_name
   FROM cart c
   JOIN cart_list cl ON c.cart_id = cl.cart_id
   JOIN product p ON cl.product_no = p.product_no
   WHERE c.cart_id = #{user_no}
</select>


<!-- 장바구니 추가 -->
<insert id="cartInsert" parameterType="cart">
    INSERT INTO cart_list
    VALUES (#{product_no}, #{product_price}, #{quantity})
      ON DUPLICATE KEY UPDATE
    quantity = quantity + #{quantity}
</insert>


<!-- 장바구니 개수 수정(+) -->
<update id="cartPlus" parameterType="cart">
	update cart_list
	set quantity = quantity+1
	where product_no = #{product_no} and cart_id = #{cart_id}
</update>


<!-- 장바구니 개수 수정(-) -->
<update id="cartMinus" parameterType="cart">
    update cart_list
    set quantity = case 
    	when quantity > 1 then quantity - 1
        else quantity
    end
    where product_no = #{product_no} and cart_id = #{cart_id}
</update>


<!-- 장바구니 삭제 -->
<delete id="cartDelete" parameterType="cart">
	delete from cart_list where product_no=#{product_no}
</delete>

<!-- 회원 정보 가져오기 -->
<select id="getUserInfo" parameterType="userVO" resultType="userVO">
	select user_name, user_phone as user_phone_num 
	from users
	where user_no = #{user_no}
</select>

</mapper>