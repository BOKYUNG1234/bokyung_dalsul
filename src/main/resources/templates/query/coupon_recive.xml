<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalsul.user.coupon_recive.dao.Coupon_reciveDAO">
	
	<!-- 검색  -->
	<sql id="couponSearch">
		<if test="search=='coupon_recive_status'">
			<![CDATA[ coupon_recive_status like '%' || #{keyword} || '%' ]]>
		</if>
	</sql>
	
	<!-- 사용자가 발급받은 쿠폰을 조회하는 조회문 쿼리 페이지네이션 , 검색기능이 있다. -->
	<select id="couponList" parameterType="coupon_recive" resultType="coupon_recive">
 	<![CDATA[
    SELECT COUPON_RECEIVE_NO, USER_NO, COUPON_NO, TO_CHAR(COUPON_RECIVE_DATE, 'YYYY-MM-DD') as COUPON_RECIVE_DATE, COUPON_RECIVE_STATUS
    FROM (
        SELECT /*+ INDEX_DESC(coupon_recive SYS_C008568) */
            rownum as rnum, coupon_recive_no, user_no, coupon_no, coupon_recive_date, coupon_recive_status
        FROM coupon_recive
      where ]]>
      <trim prefix="(" suffix=") AND " prefixOverrides="AND">
            <include refid="couponSearch"></include>
        </trim>
       <![CDATA[ rownum <= #{pageNum} * #{amount}
	   		)couponList
	   	WHERE rnum > (#{pageNum} -1) * #{amount}
	   ]]>
	</select>

    <!-- 전체 쿠폰 레코드 수 조회 -->
    <select id="couponListCnt" parameterType="coupon_recive" resultType="int">
    select count(*) FROM coupon_recive
    <if test="search != null and !search.isEmpty()">
        <trim prefix=" where (" suffix=")" >
			<include refid="couponSearch"></include>
		</trim>
    </if> 	
	</select>
	
</mapper>