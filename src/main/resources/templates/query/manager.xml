<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dalsul.manager.dao.ManagerDAO">

	<!-- 회원 조회 검색어 -->
	<sql id="userSearch"> 
		<if test="search == 'user_no'">
			<![CDATA[ user_no LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search == 'user_email'">
			<![CDATA[ user_email LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search == 'user_name'">
			<![CDATA[ user_name LIKE '%' || #{keyword} || '%' ]]>
		</if>
		<if test="search == 'user_status'">
			<![CDATA[ user_status LIKE '%' || #{keyword} || '%' ]]>
		</if>
	</sql>

	<select id="getUserList" parameterType="userVO" resultType="userVO">
		<![CDATA[
		SELECT USER_NO, USER_EMAIL, USER_NAME, 
		TO_CHAR(USER_BIRTH_DATE,'YYYY-MM-DD') as user_birth, 
		TO_CHAR(SUBSTR(USER_PHONE, 1, 3) || '-' || SUBSTR(USER_PHONE, 4, 4) || '-' || SUBSTR(USER_PHONE, 8, 4)) as user_phone_num,
		TO_CHAR(USER_REG_DATE,'YYYY-MM-DD') as user_reg_date, USER_STATUS
		FROM (
        		SELECT rownum as rnum, USER_NO, USER_EMAIL, USER_NAME, USER_BIRTH_DATE, USER_PHONE, USER_REG_DATE, USER_STATUS
        		FROM USERS
        		WHERE ]]>
					<trim prefix="(" suffix=") AND " prefixOverrides="AND">
						<include refid="userSearch"></include>
					</trim>
					<![CDATA[ rownum <= #{pageNum} * #{amount}
				ORDER BY USER_NO
			 ) userlist
		WHERE rnum > (#{pageNum} - 1) * #{amount} ]]>
	</select>
	
	<select id="userListCnt" parameterType="userVO" resultType="int">
		SELECT count(*) 
		FROM USERS
		<trim prefix=" where (" suffix=")">
			<include refid="userSearch"></include>
		</trim>
	</select>
	
	<!-- product에서 가져오려는데 productVO가 설정 파일에 없음... 
	<select id="managerMainChart" resultType="product">
	</select>-->
	
</mapper>